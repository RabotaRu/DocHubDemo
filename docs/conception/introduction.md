## Введение

DocHub - это инструмент описания архитектуры с помощью кода (Architecture as a code). Код архитектуры - набор 
связанных между собой структурированных текстовых описаний компонентов архитектуры. Описания хранятся в YAML/JSON 
файлах - манифестах. Такая концепция позволяет создавать кодовую базу архитектуры под управлением систем управления
версиями.

Функциональность DocHub можно представить Mind Map:
![Карта памяти DocHub](@document/dochub_mindmap)

![](@anchor/problems)
## Решаемые проблемы
DocHub создавался для решения ряда проблем:
1. Управление версиями архитектуры;
2. Управление децентрализованной архитектурой в Agile-ориентированных компаниях;
3. Управление архитектурой холдинга (экосистем);
4. Создание архитектурных фасадов.

Детально рассмотрим каждую:

![](@anchor/versions)
## 1. Управление версиями архитектуры 
![Управление версиями](@document/dochub_archver)

В развивающихся проектах архитектура мутабельна. Стандартной ситуацией является одновременная проработка нескольких 
архитектурных решений, которые должны стать единой архитектурой. Особенно актуальна данная проблема при наличии 
нескольких автономных команд развивающих единую систему.

Но и для монокомандой системы проблема остается актуальной. Приоритеты влияют на последовательность внедрения 
архитектурных решений. Внезапное изменение приоритетов и требований приводит к накапливанию противоречивых 
архитектурных решений. Формируется технический долг.

Аналогичные проблемы свойственны кодовой базе систем. Когда разработчики параллельно создают фичи, они сталкиваются 
с проблемой объединения результата их работы в релизы. Решается эта проблема через инкрементальное развитие кодовой
базы. Популярным инструментом решающим эту задачу является - git. 

Практикуются несколько методологий управления кодовой базой. Из популярных можно выделить 
[GitFlow](https://www.atlassian.com/en/git/tutorials/comparing-workflows/gitflow-workflow) и
[GitHub flow](https://docs.github.com/en/get-started/quickstart/github-flow).

Общая идея заключается в том, что разработчик при разработке новой фичи клонирует ветку (branch) общей кодовой базы
в отдельную ветку. В ней он ведет разработку. По завершению работы создается Pull request / Merge request. Это 
специальный, формализованный запрос в рамках системы управления версиями на объединение веток. Запрос оценивается 
(Code review) другими разработчиками. В случае положительного решения, изменения внедряются в общую кодовую базу.

Решать запросы на объединение помогают инструменты сравнения встроенные в системы управления версиями. Они наглядно
отображают изменения в коде. Выявляют конфликты. Позволяют их устранять. 

В отличие от процесса разработчики, где все построено на коде, архитектура требует создания графических артефактов.
Для этого используются различные визуальные редакторы. Объединение версий диаграмм в таком случае является проблемой.
Значительные ресурсы направляются на механическую деятельность по объединению артефактов и управления ими.

DocHub предлагает отказаться от использования визуальных редакторов в пользу описания архитектуры кодом. Использовать
принципы управления архитектурой аналогично принципам управления кодовой базы. Для этого DocHub предлагает три сущности
описания архитектурных артефактов:

* [PlantUML](https://plantuml.com/) - позволяет создавать диаграммы из обычного текстового языка;
* [Markdown](https://ru.wikipedia.org/wiki/Markdown) - язык разметки, созданный с целью обозначения форматирования в тексте;
* [Swagger](https://swagger.io/) - язык описания интерфейсов для описания RESTful API;
* [Манифесты](/docs/dochub_contexts) - структурированные файлы в формате YAML/JSON для описания архитектурных объектов. 

Таким образом, процесс развития архитектуры становится максимально близким к процессам разработки. Это дает возможность,
помимо решения основной проблемы (управление версиями архитектуры), получить дополнительные преимущества:

* Унифицировать процессы развития архитектуры и разработки;
* Архитектурные артефакты могут быть размещены непосредственно в репозитории кодовой базы и развиваться одновременно
с кодовой базой;
* Возникает возможность управления архитектурными идеями через Pull request в архитектуру;
* Создает базу для взаимного проникновения экспертиз разработки и проектирования.

![](@anchor/distrib)
## 2. Управление децентрализованной архитектурой

Под децентрализованной архитектурой понимается сложная, многокомпонентная архитектура системы, сегменты которой 
распределены по командам разработки. Каждая команда развивает свой сегмент параллельно и независимо, но должна 
учитывать общую концепцию. Ярким примером является микросервисная архитектура.

![Управление децентрализованной архитектурой](@document/dochub_archdistrib)

На передний план здесь выходит синхронизация архитектурных решений команд и развитие общего архитектурного ландшафта.
Помимо прочего, остро стоит вопрос управления технологическим стеком и переиспользование наработок соседних команд.

Концепция управления архитектурой как код позволяет применить опыт OpenSource сообществ развития продуктов. В этом 
случае существует центральный архитектурный репозиторий с концептуальной архитектурой (как будет). Все команды имеют
доступ к репозиторию получая необходимые сведения о планах развития архитектуры. Развитие репозитория происходит через
Pull requests от команд. Ревьюверами являются техлидеры команд / архитекторы.

Таким образом достигается информирование об архитектурных решений всех команд. Принятие решений возникает в консенсусе.
Происходит экстраполяция опыта команд на принимаемые решения. 
 
Описание архитектуры "как есть" остается в командах. Т.е. несмотря на то, что есть централизованный репозиторий с 
намерениями по развитию архитектуры, у команд остается право на автономное принятие быстрых решений. Этот подход
реализует [Agile манифест](https://wikipedia.org/wiki/Agile_Manifesto). Если команде нужно срочно внести обоснованные 
изменения в продукт, она должна иметь возможность это сделать. Такая ситуация считается инцидентом.

Противотечение с центральным репозиторием устраняется путем сверки "как есть" с "как будет". Отклонения обосновываются
и с отставанием вносятся в центральный репозиторий. Таким образом, инцидентные решения остаются в поле управления.  

![](@anchor/ecosystem)
## 3. Управление архитектурой холдинга (экосистем)

![Структура холдинга](@document/dochub_archeco)

Под холдингом понимается группа компаний развивающих цифровые продукты имеющие потребность в интеграции с выраженным
центром стратегического управления.

Холдинги сталкиваются с проблемой координации развития архитектуры экосистемы. Контроль достижения стратегических
целей экосистемы является ключевым для таких образований.

Компании входящие в холдинг с разной степенью автономны. Часто находятся на различных этапах развития. Это выражается
в их процессах управления. Т.е. процессы в холдинге неоднородны.  

Таким образом, управление архитектурой экосистемы является нетривиальной задачей. DocHub предлагает и тут использовать
принципы управления кодовой базой OpenSource сообществ.

![Управление архитектурой холдинга](@document/dochub_archeco_proc)

Центр в этом случае выступает майнтейнером (Maintainer) архитектурного кода. Он является владельцем центрального
репозитория архитектуры. Устанавливает стандарты работы с центральным репозиторием.

Компании выступают в роле контрибьюторов (Contributors). У них есть собственный форк или ветка в центральном 
репозитори. Развитие архитектуры экосистемы ведется через Pull requests в центральный репозиторий.

DocHub используется как универсальное средство представления артефактов экосистемы.

![](@anchor/facade)
## 4. Архитектурные фасады

![Управление архитектурой холдинга](@document/dochub_facade)

Под архитектурным фасадом понимается публичная часть архитектуры. Распространенным примером архитектурного фасада
являются API-контракты сервиса. 

Фасады могут иметь разную степень детализации и состав для разных задач. Для внешнего клиента фасад может ограничиться
только публикацией контрактов. Но зачастую, у него возникает ряд вопросов по сценариям использования. Также может
оказаться полезным отразить верхнеуровневую архитектуру публичных сервисов. Для решения этой задачи было бы полезным
иметь управляемый комплект публичных артефактов.

DocHub с этой задачей хорошо справляется. Он может быть развернут в качестве архитектурного фасада. Внешние 
пользователи получают удобный интерфейс для изучения публичной архитектуры.
